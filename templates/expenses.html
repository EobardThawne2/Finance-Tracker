{% extends "base.html" %}

{% block title %}Expenses - Finance Tracker{% endblock %}

{% block content %}
<div class="expenses-page">
    <div class="page-header">
        <div>
            <h1>All expenses</h1>
            <p class="page-subtitle">View and manage all your expense records</p>
        </div>
        <a href="{{ url_for('add_expense_page') }}" class="btn btn-primary">+ New expense</a>
    </div>

    <!-- Filters -->
    <div class="filters-card">
        <form method="GET" class="filters-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="start_date">From</label>
                    <input type="date" id="start_date" name="start_date" 
                           value="{{ filters.start_date or '' }}">
                </div>
                <div class="form-group">
                    <label for="end_date">To</label>
                    <input type="date" id="end_date" name="end_date" 
                           value="{{ filters.end_date or '' }}">
                </div>
                <div class="form-group">
                    <label for="category">Category</label>
                    <select id="category" name="category">
                        <option value="">All categories</option>
                        {% for cat in categories %}
                            <option value="{{ cat }}" {% if cat == filters.category %}selected{% endif %}>
                                {{ cat }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group filter-buttons">
                    <button type="submit" class="btn btn-primary">Apply</button>
                    <a href="{{ url_for('expenses_list') }}" class="btn btn-outline">Clear</a>
                </div>
            </div>
        </form>
    </div>

    <!-- Expenses Table -->
    {% if expenses %}
        <div class="table-container">
            <table class="expense-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Category</th>
                        <th>Description</th>
                        <th>Amount</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for expense in expenses %}
                        <tr>
                            <td>{{ expense.date }}</td>
                            <td>
                                <span class="category-badge">{{ expense.category }}</span>
                            </td>
                            <td>{{ expense.description or 'â€”' }}</td>
                            <td>
                                <div class="amount-cell">
                                    {% if expense.currency != 'INR' %}
                                        <span class="original">{{ expense.currency }} {{ expense.amount }}</span>
                                    {% endif %}
                                    <span class="converted">â‚¹{{ "{:,.2f}".format(expense.base_amount) }}</span>
                                </div>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <a href="{{ url_for('edit_expense_page', expense_id=expense.expense_id) }}" 
                                       class="btn btn-sm btn-outline">Edit</a>
                                    <form action="{{ url_for('delete_expense_route', expense_id=expense.expense_id) }}" 
                                          method="POST" class="inline-form"
                                          onsubmit="return confirm('Delete this expense?')">
                                        <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Summary -->
        <div class="expense-summary">
            <p><strong>Total Expenses:</strong> {{ expenses|length }}</p>
            <p><strong>Total Amount:</strong> â‚¹{{ "{:,.2f}".format(expenses|sum(attribute='base_amount')) }}</p>
        </div>
    {% else %}
        <div class="empty-state">
            <div class="empty-icon">ðŸ“‹</div>
            <h3>No expenses found</h3>
            <p>{% if filters.start_date or filters.end_date or filters.category %}
                Try adjusting your filters to see more results.
            {% else %}
                Start tracking your expenses to see them here.
            {% endif %}</p>
            <a href="{{ url_for('add_expense_page') }}" class="btn btn-primary">Add expense</a>
        </div>
    {% endif %}
</div>
{% endblock %}
