{% extends "base.html" %}

{% block title %}Add Expense - Finance Tracker{% endblock %}

{% block content %}
<div class="form-page">
    <div class="form-container">
        <div class="form-card">
            <div class="form-header">
                <h1>Add new expense</h1>
                <p>Record a new expense with category and amount</p>
            </div>
            
            <form method="POST" class="expense-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="amount">Amount</label>
                        <input type="number" id="amount" name="amount" 
                               step="0.01" min="0.01" required
                               placeholder="0.00">
                    </div>
                    
                    <div class="form-group">
                        <label for="currency">Currency</label>
                        <select id="currency" name="currency">
                            {% for curr in currencies[:20] %}
                                <option value="{{ curr }}" {% if curr == 'INR' %}selected{% endif %}>
                                    {{ curr }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="category">Category</label>
                    <select id="category" name="category" required>
                        <option value="">Select category</option>
                        {% for cat in categories %}
                            <option value="{{ cat }}">{{ cat }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="date">Date</label>
                    <input type="date" id="date" name="date" 
                           value="{{ today }}" required>
                </div>
                
                <div class="form-group">
                    <label for="description">Description</label>
                    <textarea id="description" name="description" rows="3"
                              placeholder="Optional notes about this expense"></textarea>
                </div>
                
                <!-- Currency conversion preview -->
                <div id="conversion-preview" class="conversion-preview" style="display: none;">
                    <span>Converted to INR: </span>
                    <span id="converted-amount">₹0.00</span>
                </div>
                
                <div class="form-actions">
                    <a href="{{ url_for('dashboard') }}" class="btn btn-outline">Cancel</a>
                    <button type="submit" class="btn btn-primary">Add expense</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Currency conversion preview
const amountInput = document.getElementById('amount');
const currencySelect = document.getElementById('currency');
const conversionPreview = document.getElementById('conversion-preview');
const convertedAmount = document.getElementById('converted-amount');

async function updateConversion() {
    const amount = parseFloat(amountInput.value);
    const currency = currencySelect.value;
    
    if (amount && currency !== 'INR') {
        conversionPreview.style.display = 'block';
        try {
            const response = await fetch(`/api/convert?amount=${amount}&from=${currency}&to=INR`);
            const data = await response.json();
            if (data.success) {
                convertedAmount.textContent = `₹${data.converted.toLocaleString('en-IN', {minimumFractionDigits: 2})}`;
            }
        } catch (e) {
            convertedAmount.textContent = 'Unable to convert';
        }
    } else {
        conversionPreview.style.display = 'none';
    }
}

amountInput.addEventListener('input', updateConversion);
currencySelect.addEventListener('change', updateConversion);
</script>
{% endblock %}
